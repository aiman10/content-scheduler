<div *ngIf="loading" class="loading-animation">
  <!-- Your loading animation here -->
  <div class="spinner"></div>
</div>
<div *ngIf="!loading">
  <div class="container">
    <div class="calendar">
      <div class="date-selector flex flex-wrap items-center justify-between mb-4">
        <div class="flex items-center space-x-2">
          <button class="p-2" (click)="previousYear()">
            <i class="fas fa-chevron-left"></i>
          </button>
          <span class="text-lg font-semibold">{{ selectedYear }}</span>
          <button class="p-2" (click)="nextYear()">
            <i class="fas fa-chevron-right"></i>
          </button>
        </div>
        <div class="flex items-center space-x-2">
          <select [(ngModel)]="selectedMonth" (change)="onDateChange()" class="border rounded p-1">
            <option *ngFor="let month of months; let i = index" [value]="i">{{ month }}</option>
          </select>
          <select [(ngModel)]="selectedView" class="border rounded p-1">
            <option>Month</option>
            <option>Week</option>
          </select>
        </div>
        <h1 class="text-xl font-bold ml-4">Releasedates for {{ months[selectedMonth] }} {{ selectedYear }}</h1>
      </div>

      <div class="week">
        <div class="day2 header">Mon</div>
        <div class="day2 header">Tue</div>
        <div class="day2 header">Wed</div>
        <div class="day2 header">Thu</div>
        <div class="day2 header">Fri</div>
        <div class="day2 header weekend-header">Sat</div>
        <div class="day2 header weekend-header">Sun</div>
      </div>
      <div *ngIf="selectedView === 'Month'" class="month-view">
        <div class="week" *ngFor="let week of weeks">
          <ng-container *ngFor="let day of week; let i = index">
            <div
              class="day square rounded-md shadow-sm hover:shadow-md transition"
              [ngClass]="{ 'weekend-day': i === 5 || i === 6 }"
              (click)="onDayClick(day)"
              (mouseenter)="onDayMouseEnter(day)"
              (mouseleave)="onDayMouseLeave()"
              [class.hovered]="isHovered(day)"
              [class.today]="isToday(day)"
            >
              <ng-container *ngIf="day !== 0">
                <div class="day-title">{{ day }}</div>

                <div *ngFor="let movie of getMoviesForDay(day); let i = index">
                  <div
                    class="small-text flex items-center justify-between"
                    [ngClass]="{
                      'bookmarked-movie': movie.isBookmarked,
                      'film-background': !movie.isBookmarked
                    }"
                  >
                    <span class="truncate text-white">{{ movie.title | slice:0:25 }}</span>
                    <div class="flex items-center space-x-1">
                      <button class="text-yellow-400" (click)="toggleBookmark(movie); $event.stopPropagation();">
                        <i class="fa-solid fa-bookmark" *ngIf="movie.isBookmarked"></i>
                        <i class="fa-regular fa-bookmark" *ngIf="!movie.isBookmarked"></i>
                      </button>
                      <button class="text-blue-200" (click)="downloadICSCalendar(movie); $event.stopPropagation();">
                        <i class="fas fa-download"></i>
                      </button>
                    </div>
                  </div>
                </div>
                <div *ngIf="getMovieCountForDay(day) >= 1" class="movie-count">
                  <div class="more-movies">
                    {{ getMovieCountForDay(day) }} more
                  </div>
                  <!-- Tooltip div -->
                  <div class="tooltip" *ngIf="isHovered(day)" [@fadeInOut]>
                    <div
                      *ngFor="let movie of getFullMoviesForDay(day)"
                      [ngClass]="{
                        'small-text bookmarked-movie': movie.isBookmarked,
                        'small-text film-background': !movie.isBookmarked
                      }"
                    >
                      {{ movie.title }}
                    </div>
                  </div>
                </div>
              </ng-container>
            </div>
          </ng-container>
        </div>
      </div>
      <div *ngIf="selectedView === 'Week'" class="week">
        <div class="week-navigation">
          <button class="nav-button prev-button" (click)="previousWeek()">
            <i class="fas fa-arrow-left"></i>
            <!-- Left arrow icon (using FontAwesome) -->
          </button>
          <button class="nav-button next-button" (click)="nextWeek()">
            <i class="fas fa-arrow-right"></i>
            <!-- Right arrow icon (using FontAwesome) -->
          </button>
        </div>
        <div
          *ngFor="let day of weeks[0]; let i = index"
          class="day square week-square rounded-md shadow-sm hover:shadow-md transition"
          [ngClass]="{ 'weekend-day': i === 5 || i === 6 }"
          (click)="onDayClick(day)"
        >
          <ng-container *ngIf="day !== 0">
            <div class="day-title">{{ day }}</div>

            <div *ngFor="let movie of getMoviesForWeek(day); let i = index">
              <div
                class="small-text flex items-center justify-between"
                [ngClass]="{
                  'bookmarked-movie': movie.isBookmarked,
                  'film-background': !movie.isBookmarked
                }"
              >
                <span class="truncate text-white">{{ movie.title | slice:0:25 }}</span>
                <div class="flex items-center space-x-1">
                  <button class="text-yellow-400" (click)="toggleBookmark(movie); $event.stopPropagation();">
                    <i class="fa-solid fa-bookmark" *ngIf="movie.isBookmarked"></i>
                    <i class="fa-regular fa-bookmark" *ngIf="!movie.isBookmarked"></i>
                  </button>
                  <button class="text-blue-200" (click)="downloadICSCalendar(movie); $event.stopPropagation();">
                    <i class="fas fa-download"></i>
                  </button>
                </div>
              </div>
            </div>
          </ng-container>
        </div>
      </div>
    </div>
  </div>
  <br />
</div>
